<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IFM Quoting App</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e40af">

    <link rel="apple-touch-icon" href="/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192x192.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="min-h-screen flex flex-col">
    <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 shadow-lg sticky top-0 z-10">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-2xl font-bold">IFM Quoting App</h1>
            <button id="backButton" class="hidden bg-blue-700 hover:bg-blue-900 text-white font-semibold py-2 px-4 rounded-full shadow-md transition duration-300 ease-in-out">
                Back
            </button>
        </div>
    </header>

    <main id="app-container" class="flex-grow container mx-auto p-4">
        <div id="loading-spinner" class="hidden fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-75 z-[1000]">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500"></div>
            <p class="text-white ml-4 text-lg">Loading...</p>
        </div>

        <section id="projects-view" class="space-y-4 fade-in">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Your Quotes</h2>
            <button id="addProjectBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 ease-in-out hover:scale-105">
                + Add New Quote
            </button>
            <div id="projectsList" class="grid grid-cols-1 gap-4 mt-6">
                </div>
        </section>

        <section id="sites-view" class="hidden space-y-4 fade-in">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Sites for <span id="currentProjectName" class="text-blue-600"></span></h2>
            <button id="addSiteBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 ease-in-out hover:scale-105">
                + Add New Site
            </button>
            <div id="sitesList" class="grid grid-cols-1 gap-4 mt-6">
                </div>
        </section>

        <section id="zones-view" class="hidden space-y-4 fade-in">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Zones for <span id="currentSiteName" class="text-blue-600"></span></h2>
            <button id="addZoneBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 ease-in-out hover:scale-105">
                + Add New Zone
            </button>
            <div id="zonesList" class="grid grid-cols-1 gap-4 mt-6">
                </div>
        </section>

        <section id="services-view" class="hidden space-y-4 fade-in">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Services for <span id="currentZoneName" class="text-blue-600"></span></h2>
            <button id="addServiceBtn" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 ease-in-out hover:scale-105">
                + Add New Service
            </button>
            <div id="servicesList" class="grid grid-cols-1 gap-4 mt-6">
                </div>
        </section>

        <section id="service-detail-view" class="hidden space-y-4 fade-in">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Service Details: <span id="currentServiceTypeName" class="text-blue-600"></span></h2>
            <form id="serviceDetailForm" class="bg-white p-6 rounded-lg shadow-md space-y-4">
                <div id="dynamicServiceFields">
                    </div>

                <h3 class="text-xl font-semibold text-gray-700 mt-6 mb-4">Notes</h3>
                <div>
                    <label for="serviceNote" class="block text-gray-700 font-semibold mb-2">Add any comments here</label>
                    <textarea id="serviceNote" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4"></textarea>
                </div>

                <h3 class="text-xl font-semibold text-gray-700 mt-6 mb-4">Service Images</h3>
                <input type="file" id="serviceImageInput" accept="image/*" capture="camera" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <div id="serviceImagesPreview" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mt-4">
                    </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 ease-in-out hover:scale-105">
                    Save Service Details
                </button>
                <button type="button" id="deleteServiceBtn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 ease-in-out hover:scale-105 mt-2">
                    Delete Service
                </button>
            </form>
        </section>
    </main>

    <div id="projectModal" class="fixed inset-0 hidden items-center justify-center modal-overlay">
        <div class="bg-white p-8 rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3 modal-content fade-in">
            <h3 class="text-2xl font-bold text-gray-800 mb-4" id="projectModalTitle">Add New Quote</h3>
            <form id="projectForm" class="space-y-4">
                <div>
                    <label for="projectName" class="block text-gray-700 font-semibold mb-2">Quote Name</label>
                    <input type="text" id="projectName" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label for="projectClient" class="block text-gray-700 font-semibold mb-2">Client Name</label>
                    <input type="text" id="projectClient" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label for="clientCategory" class="block text-gray-700 font-semibold mb-2">Client Category</label>
                    <select id="clientCategory" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Category</option>
                        <option value="Industrial">Industrial</option>
                        <option value="Commercial">Commercial</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="District Energy">District Energy</option>
                    </select>
                </div>
                <div id="clientSubcategoryGroup" class="hidden">
                    <label for="clientSubcategory" class="block text-gray-700 font-semibold mb-2">Client Subcategory</label>
                    <select id="clientSubcategory" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Subcategory</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelProjectBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">Cancel</button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">Save Quote</button>
                </div>
            </form>
        </div>
    </div>

    <div id="siteModal" class="fixed inset-0 hidden items-center justify-center modal-overlay">
        <div class="bg-white p-8 rounded-lg shadow-xl w-11/12 md:w-2/3 lg:w-1/2 modal-content fade-in">
            <h3 class="text-2xl font-bold text-gray-800 mb-4" id="siteModalTitle">Add New Site</h3>
            <form id="siteForm" class="space-y-4">
                <div>
                    <label for="siteName" class="block text-gray-700 font-semibold mb-2">Site Name</label>
                    <input type="text" id="siteName" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label for="siteAddress" class="block text-gray-700 font-semibold mb-2">Address</label>
                    <input type="text" id="siteAddress" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label for="siteTotalSqFt" class="block text-gray-700 font-semibold mb-2">Total Square Footage</label>
                    <input type="number" id="siteTotalSqFt" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label for="sitePersonnelShifts" class="block text-gray-700 font-semibold mb-2">Personnel Shifts & Hours</label>
                    <textarea id="sitePersonnelShifts" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
                </div>

                <h3 class="text-xl font-semibold text-gray-700 mt-6 mb-4 border-b pb-2">Maintenance Strategy</h3>
                <div>
                    <label for="ppmRmSplitCurrent" class="block text-gray-700 font-semibold mb-2">Current PPM/RM Split (e.g., 70% Planned, 30% Reactive)</label>
                    <input type="text" id="ppmRmSplitCurrent" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="ppmRmSplitProposed" class="block text-gray-700 font-semibold mb-2">Proposed PPM/RM Split (e.g., 85% Planned, 15% Reactive)</label>
                    <input type="text" id="ppmRmSplitProposed" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="detailedSLAs" class="block text-gray-700 font-semibold mb-2">Detailed SLAs (e.g., Critical: 1-hour response, 4-hour resolution)</label>
                    <textarea id="detailedSLAs" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
                </div>
                <div>
                    <label for="clientPriorityPainPoints" class="block text-gray-700 font-semibold mb-2">Client Priority / Pain Points</label>
                    <textarea id="clientPriorityPainPoints" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
                </div>
                <div>
                    <label for="complianceRequirements" class="block text-gray-700 font-semibold mb-2">Compliance Requirements (e.g., Annual fire system inspection)</label>
                    <textarea id="complianceRequirements" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
                </div>

                <h3 class="text-xl font-semibold text-gray-700 mt-6 mb-4 border-b pb-2">Asset Register</h3>
                <button type="button" id="addAssetBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow-sm mb-4">
                    + Add New Asset
                </button>
                <div id="assetsList" class="space-y-3">
                    </div>

                <h3 class="text-xl font-semibold text-gray-700 mt-6 mb-4">Site Images</h3>
                <input type="file" id="siteImageInput" accept="image/*" capture="camera" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <div id="siteImagesPreview" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mt-4">
                    </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelSiteBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">Cancel</button>
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">Save Site</button>
                </div>
            </form>
        </div>
    </div>

    <div id="zoneModal" class="fixed inset-0 hidden items-center justify-center modal-overlay">
        <div class="bg-white p-8 rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3 modal-content fade-in">
            <h3 class="text-2xl font-bold text-gray-800 mb-4" id="zoneModalTitle">Add New Zone</h3>
            <form id="zoneForm" class="space-y-4">
                <div>
                    <label for="zoneName" class="block text-gray-700 font-semibold mb-2">Zone Name</label>
                    <input type="text" id="zoneName" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label for="zoneSqFt" class="block text-gray-700 font-semibold mb-2">Zone Square Footage</label>
                    <input type="number" id="zoneSqFt" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label for="zoneFunction" class="block text-gray-700 font-semibold mb-2">Zone Function</label>
                    <select id="zoneFunction" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Function</option>
                        <option value="Office">Office</option>
                        <option value="Production">Production</option>
                        <option value="Warehouse">Warehouse</option>
                        <option value="Parking">Parking</option>
                        <option value="Technical Room">Technical Room</option>
                        <option value="Server Room">Server Room</option>
                        <option value="Laboratory">Laboratory</option>
                        <option value="Cleanroom">Cleanroom</option>
                        <option value="Restroom">Restroom</option>
                        <option value="Cafeteria">Cafeteria</option>
                        <option value="Common Area">Common Area</option>
                        <option value="Exterior">Exterior</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <h3 class="text-xl font-semibold text-gray-700 mt-6 mb-4">Zone Images</h3>
                <input type="file" id="zoneImageInput" accept="image/*" capture="camera" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <div id="zoneImagesPreview" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mt-4">
                    </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelZoneBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">Cancel</button>
                    <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">Save Zone</button>
                </div>
            </form>
        </div>
    </div>

    <div id="serviceModal" class="fixed inset-0 hidden items-center justify-center modal-overlay">
        <div class="bg-white p-8 rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3 modal-content fade-in">
            <h3 class="text-2xl font-bold text-gray-800 mb-4" id="serviceModalTitle">Add New Service</h3>
            <form id="serviceForm" class="space-y-4">
                <div>
                    <label for="serviceType" class="block text-gray-700 font-semibold mb-2">Service Type</label>
                    <select id="serviceType" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        <option value="">Select a service type</option>
                        </select>
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelServiceBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">Cancel</button>
                    <button type="submit" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">Add Service</button>
                </div>
            </form>
        </div>
    </div>

    <div id="assetModal" class="fixed inset-0 hidden items-center justify-center modal-overlay">
        <div class="bg-white p-8 rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3 modal-content fade-in">
            <h3 class="text-2xl font-bold text-gray-800 mb-4" id="assetModalTitle">Add New Asset</h3>
            <form id="assetForm" class="space-y-4">
                <div>
                    <label for="assetType" class="block text-gray-700 font-semibold mb-2">Asset Type</label>
                    <input type="text" id="assetType" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required placeholder="e.g., HVAC Unit, Chiller, Electrical Panel">
                </div>
                <div>
                    <label for="assetQuantity" class="block text-gray-700 font-semibold mb-2">Quantity</label>
                    <input type="number" id="assetQuantity" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required value="1">
                </div>
                <div>
                    <label for="assetLocation" class="block text-gray-700 font-semibold mb-2">Location (Zone/Room)</label>
                    <input type="text" id="assetLocation" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Zone A, Server Room">
                </div>
                <div>
                    <label for="assetCriticality" class="block text-gray-700 font-semibold mb-2">Criticality</label>
                    <select id="assetCriticality" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Criticality</option>
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </div>
                <div>
                    <label for="assetCondition" class="block text-gray-700 font-semibold mb-2">Condition</label>
                    <select id="assetCondition" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Condition</option>
                        <option value="New">New</option>
                        <option value="Good">Good</option>
                        <option value="Fair">Fair</option>
                        <option value="Poor">Poor</option>
                    </select>
                </div>
                <div>
                    <label for="assetManufacturerModel" class="block text-gray-700 font-semibold mb-2">Manufacturer / Model</label>
                    <input type="text" id="assetManufacturerModel" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Carrier 30XA, IBM Power9">
                </div>
                <div>
                    <label for="assetInstallationDate" class="block text-gray-700 font-semibold mb-2">Installation Date</label>
                    <input type="date" id="assetInstallationDate" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="assetLastServiceDate" class="block text-gray-700 font-semibold mb-2">Last Service Date</label>
                    <input type="date" id="assetLastServiceDate" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="assetNextDueDate" class="block text-gray-700 font-semibold mb-2">Next Due Date</label>
                    <input type="date" id="assetNextDueDate" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelAssetBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">Cancel</button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">Save Asset</button>
                </div>
            </form>
        </div>
    </div>

    <div id="messageBox" class="fixed inset-0 hidden items-center justify-center modal-overlay">
        <div class="bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-1/3 text-center fade-in">
            <p id="messageBoxText" class="text-lg font-semibold text-gray-800 mb-4"></p>
            <button id="messageBoxOkBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">OK</button>
        </div>
    </div>

    <div id="confirmationBox" class="fixed inset-0 hidden items-center justify-center modal-overlay">
        <div class="bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-1/3 text-center fade-in">
            <p id="confirmationBoxText" class="text-lg font-semibold text-gray-800 mb-4"></p>
            <div class="flex justify-center space-x-4">
                <button id="confirmationBoxCancelBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">Cancel</button>
                <button id="confirmationBoxConfirmBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">Confirm</button>
            </div>
        </div>
    </div>

    <script src="app.js" type="module"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('Service Worker Registered'))
                    .catch(err => console.log('Service Worker Registration Failed:', err));
            });
        }
    </script>
</body>
</html>